docker pull ubuntu:12.04
docker pull ubuntu:16.04

BASE=$HOME/src/casa-distro/docker
for OS in ubuntu-12.04 ubuntu-16.04; do
  echo Building cati/brainvisa-test:$OS. Log in $BASE/brainvisa-test:$OS.log
  docker build -t cati/brainvisa-test:$OS $BASE/brainvisa-test/$OS > $BASE/brainvisa-test:$OS.log 2>&1
  if [ $? != 0 ]; then
    echo ERROR: build failed
    exit 1
  fi
  echo Pushing cati/brainvisa-test:$OS
  docker push cati/brainvisa-test:$OS

  echo Building cati/brainvisa-devbase:$OS. Log in $BASE/brainvisa-devbase:$OS.log
  docker build -t cati/brainvisa-devbase:$OS $BASE/brainvisa-devbase/$OS > $BASE/brainvisa-devbase:$OS.log 2>&1
  if [ $? != 0 ]; then
    echo ERROR: build failed
    exit 1
  fi
  echo Pushing cati/brainvisa-devbase:$OS
  docker push cati/brainvisa-devbase:$OS

  for BRANCH in bug_fix trunk; do
    echo Building cati/brainvisa-opensource:$OS-$BRANCH. Log in $BASE/brainvisa-opensource:$OS-$BRANCH.log
    docker build -t cati/brainvisa-opensource:$OS-$BRANCH $BASE/brainvisa-opensource/$OS-$BRANCH > $BASE/brainvisa-opensource:$OS-$BRANCH.log 2>&1
    if [ $? != 0 ]; then
      echo ERROR: build failed
      exit 1
    fi
    echo Pushing cati/brainvisa-opensource:$OS-$BRANCH
    docker push cati/brainvisa-opensource:$OS-$BRANCH
  done
done

