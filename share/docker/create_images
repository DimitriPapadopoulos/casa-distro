docker pull ubuntu:12.04
docker pull ubuntu:16.04

BASE=`dirname "$0"`
BASE=`realpath "$BASE"`
for OS in ubuntu-12.04 ubuntu-16.04; do
  echo Building cati/casa-test:$OS. Log in $BASE/casa-test:$OS.log
  docker build -t cati/casa-test:$OS $BASE/casa-test/$OS > $BASE/casa-test:$OS.log 2>&1
  if [ $? != 0 ]; then
    echo ERROR: build failed
    exit 1
  fi
  echo Pushing cati/casa-test:$OS
  docker push cati/casa-test:$OS

  echo Building cati/casa-dev:$OS. Log in $BASE/casa-dev:$OS.log
  docker build -t cati/casa-dev:$OS $BASE/casa-dev/$OS > $BASE/casa-dev:$OS.log 2>&1
  if [ $? != 0 ]; then
    echo ERROR: build failed
    exit 1
  fi
  echo Pushing cati/casa-dev:$OS
  docker push cati/casa-dev:$OS

  for BRANCH in bug_fix trunk; do
    echo Building cati/brainvisa-dev-opensource:$OS-$BRANCH. Log in $BASE/brainvisa-dev-opensource:$OS-$BRANCH.log
    docker build -t cati/brainvisa-dev-opensource:$OS-$BRANCH $BASE/brainvisa-dev-opensource/$OS-$BRANCH > $BASE/brainvisa-dev-opensource:$OS-$BRANCH.log 2>&1
    if [ $? != 0 ]; then
      echo ERROR: build failed
      exit 1
    fi
    echo Pushing cati/brainvisa-dev-opensource:$OS-$BRANCH
    docker push cati/brainvisa-dev-opensource:$OS-$BRANCH
  done
done

